<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GlobeTrotter ‚Äî Travel Planner (Hackathon Starter)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /*
      GlobeTrotter ‚Äî Single-file HTML/CSS/JS SPA
      -------------------------------------------------
      ‚ú® Drop this file into VS Code and open with Live Server (recommended)
      ‚ú® All data is stored in localStorage for demo purposes
      ‚ú® No external JS frameworks; pure, modern JS
      ‚ú® Designed for hackathon speed + clarity; modular, commented code

      Sections:
      1) CSS variables + reset
      2) Layout & components
      3) Screen-specific styles
      4) Utility classes
    */

    /* 1) Variables + reset */
    :root {
      --bg: #0b1020;
      --panel: #111831;
      --panel-2: #0f1530;
      --muted: #8892a6;
      --text: #e8ecf5;
      --brand: #6ee7ff; /* cyan */
      --brand-2: #8b5cf6; /* violet */
      --accent: #22c55e; /* green */
      --warn: #f59e0b;  /* amber */
      --danger: #ef4444; /* red */
      --border: rgba(255,255,255,0.08);
      --card: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      --shadow: 0 10px 30px rgba(0,0,0,0.3);
      --radius: 16px;
      --radius-lg: 24px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 70% -10%, rgba(110,231,255,0.15), transparent 60%),
                  radial-gradient(800px 400px at 0% 20%, rgba(139,92,246,0.18), transparent 60%),
                  var(--bg);
    }
    img { max-width: 100%; display: block; }
    a { color: inherit; text-decoration: none; }
    button { font: inherit; }
    input, select, textarea { background: #0b1225; border: 1px solid var(--border); color: var(--text); border-radius: 12px; padding: 10px 12px; }
    label { font-size: 12px; color: var(--muted); }

    /* 2) App layout */
    .app {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }
    .sidebar {
      position: sticky; top: 0; height: 100dvh;
      background: linear-gradient(180deg, #0f1530, #0b1225 50%, #0b1020);
      border-right: 1px solid var(--border);
      padding: 20px;
    }
    .brand {
      display: flex; align-items: center; gap: 12px; margin-bottom: 20px;
    }
    .brand-logo {
      width: 40px; height: 40px; border-radius: 12px;
      background: conic-gradient(from 120deg, var(--brand), var(--brand-2), #60a5fa, var(--brand));
      box-shadow: inset 0 0 20px rgba(255,255,255,0.2), 0 10px 24px rgba(110,231,255,0.15);
    }
    .brand h1 { font-size: 18px; margin: 0; letter-spacing: 0.3px; }
    .nav { display: grid; gap: 8px; margin-top: 10px; }
    .nav button {
      display: grid; grid-template-columns: 24px 1fr auto; align-items: center; gap: 10px;
      padding: 10px 12px; border: 1px solid var(--border); border-radius: 12px;
      background: var(--panel); color: var(--text); cursor: pointer;
      box-shadow: var(--shadow);
    }
    .nav button.active { outline: 2px solid rgba(110,231,255,0.35); background: #0f1836; }
    .nav .badge { font-size: 11px; background: rgba(255,255,255,0.06); border: 1px solid var(--border); padding: 2px 6px; border-radius: 99px; }

    .user-card {
      margin-top: 16px; padding: 14px; border: 1px solid var(--border); border-radius: var(--radius);
      background: var(--card);
    }

    .content {
      padding: 28px; display: grid; gap: 18px;
    }

    .toolbar { display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content: space-between; }
    .toolbar .left, .toolbar .right { display:flex; gap:10px; align-items:center; }
    .search { display:flex; gap:8px; align-items:center; background:#0b1225; border:1px solid var(--border); padding:8px 10px; border-radius:999px; }
    .search input { background: transparent; border: none; padding: 6px 6px; outline: none; width: 220px; }

    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
    .card {
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .card h3 { margin: 0 0 10px 0; font-size: 16px; }
    .card .muted { color: var(--muted); font-size: 13px; }
    .chips { display:flex; flex-wrap:wrap; gap:8px; }
    .chip { padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:#0b1225; font-size:12px; }

    .btn { padding:10px 14px; border:none; border-radius:12px; background:linear-gradient(180deg, #0ea5e9, #22d3ee); color:#001321; font-weight:700; cursor:pointer; box-shadow: var(--shadow); }
    .btn.secondary { background: #1f2a4d; color: var(--text); border:1px solid var(--border); }
    .btn.ghost { background: transparent; border:1px solid var(--border); color: var(--text); }
    .btn.warn { background: linear-gradient(180deg, #f59e0b, #f97316); color:#180b00; }
    .btn.danger { background: linear-gradient(180deg, #ef4444, #dc2626); color: #180000; }

    .input-row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .input-col { display:grid; gap:6px; }

    .list { display:grid; gap:10px; }
    .list-item {
      display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center;
      padding:12px; border:1px solid var(--border); border-radius:12px; background:#0b1225;
    }
    .list-item .actions { display:flex; gap:8px; }

    .hero {
      padding: 18px; border-radius: 22px; background: radial-gradient(800px 400px at 20% -20%, rgba(110,231,255,0.18), transparent 50%),
        linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
      border: 1px solid var(--border);
    }

    .kpi { display:grid; grid-template-columns: repeat(4,1fr); gap:14px; }
    .kpi .card { display:grid; gap:4px; }
    .kpi .value { font-size: 22px; font-weight: 800; }
    .kpi .label { color: var(--muted); font-size: 12px; }

    .pill { padding: 3px 8px; border-radius: 999px; border:1px solid var(--border); font-size: 11px; color: var(--muted); }
    .tag-green { background: rgba(34,197,94,0.15); color:#a7f3d0; }
    .tag-red { background: rgba(239,68,68,0.12); color:#fecaca; }
    .tag-amber { background: rgba(245,158,11,0.12); color:#fde68a; }

    /* 3) Screen styles */
    .screen { display: none; }
    .screen.active { display: block; }

    .trip-card { display:grid; gap:8px; border:1px solid var(--border); border-radius: 16px; padding: 12px; background:#0b1225; }
    .trip-title { font-weight: 700; }
    .trip-meta { color: var(--muted); font-size: 12px; }
    .trip-actions { display:flex; gap:8px; }

    .calendar-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; }
    .calendar-day { border:1px solid var(--border); border-radius: 12px; padding:8px; min-height: 80px; background:#0b1225; }

    .timeline { display:grid; gap:10px; }
    .timeline-item { display:grid; grid-template-columns: 28px 1fr; gap:10px; align-items:start; }
    .timeline-dot { width:10px; height:10px; border-radius:50%; background: var(--brand); margin-top:6px; box-shadow: 0 0 0 4px rgba(110,231,255,0.15); }
    .timeline-card { border:1px solid var(--border); border-radius:12px; padding:10px; background:#0b1225; }

    .stop { border:1px dashed var(--border); border-radius:12px; padding:10px; background:#0b1225; }
    .activity { display:flex; justify-content:space-between; gap:8px; padding:8px; border:1px solid var(--border); border-radius:10px; background:#0e1530; }

    /* Responsive */
    @media (max-width: 960px) {
      .app { grid-template-columns: 1fr; }
      .sidebar { position: static; height: auto; }
      .kpi { grid-template-columns: repeat(2, 1fr); }
      .input-row { grid-template-columns: 1fr; }
      .grid { grid-template-columns: repeat(1, 1fr); }
    }

    /* 4) Utilities */
    .mt-6 { margin-top: 6px; } .mt-10 { margin-top: 10px; } .mt-14 { margin-top: 14px; }
    .mb-6 { margin-bottom: 6px; } .mb-10 { margin-bottom: 10px; } .mb-14 { margin-bottom: 14px; }
    .flex { display:flex; } .items-center { align-items:center; } .justify-between { justify-content:space-between; } .gap-8 { gap:8px; }
    .hint { color: var(--muted); font-size: 12px; }
    .center { display:grid; place-items: center; }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true"></div>
        <h1>GlobeTrotter</h1>
      </div>
      <div class="user-card" id="userCard">
        <div style="display:flex; align-items:center; gap:10px;">
          <div style="width:38px;height:38px;border-radius:50%;background:linear-gradient(180deg,#38bdf8,#8b5cf6);"></div>
          <div>
            <div id="userName" style="font-weight:700">Guest</div>
            <div class="hint" id="userEmail">Not signed in</div>
          </div>
        </div>
        <div class="mt-10" style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn secondary" data-route="auth">Login/Signup</button>
          <button class="btn ghost" id="logoutBtn">Logout</button>
        </div>
      </div>

      <nav class="nav mt-14" id="nav">
        <button data-route="dashboard" class="active"><span>üè†</span><span>Dashboard</span><span class="badge">Home</span></button>
        <button data-route="createTrip"><span>ü™Ñ</span><span>Create Trip</span><span class="badge">New</span></button>
        <button data-route="trips"><span>üß≥</span><span>My Trips</span><span class="badge" id="tripCount">0</span></button>
        <button data-route="builder"><span>üß≠</span><span>Itinerary Builder</span><span class="badge">Plan</span></button>
        <button data-route="itinerary"><span>üó∫Ô∏è</span><span>Itinerary View</span><span class="badge">View</span></button>
        <button data-route="citySearch"><span>üåÜ</span><span>City Search</span><span class="badge">Discover</span></button>
        <button data-route="activitySearch"><span>üéüÔ∏è</span><span>Activity Search</span><span class="badge">Fun</span></button>
        <button data-route="budget"><span>üí∏</span><span>Budget</span><span class="badge">$</span></button>
        <button data-route="timeline"><span>üìÖ</span><span>Calendar/Timeline</span><span class="badge">Flow</span></button>
        <button data-route="share"><span>üîó</span><span>Shared View</span><span class="badge">Public</span></button>
        <button data-route="profile"><span>üë§</span><span>Profile</span><span class="badge">You</span></button>
        <button data-route="admin"><span>üìä</span><span>Admin/Analytics</span><span class="badge">Optional</span></button>
      </nav>

      <div class="mt-14 hint">Tip: Use the left nav to switch screens. Your data saves in your browser.</div>
    </aside>

    <!-- Main Content -->
    <main class="content">
      <div class="toolbar">
        <div class="left">
          <div class="search"><span>üîé</span><input id="globalSearch" placeholder="Search trips, cities, activities..."/></div>
          <span class="pill" id="activeRouteLabel">Dashboard</span>
        </div>
        <div class="right">
          <button class="btn" data-route="createTrip">Plan New Trip</button>
          <button class="btn secondary" data-route="trips">My Trips</button>
        </div>
      </div>

      <!-- Screens -->
      <section id="screen-auth" class="screen">
        <div class="grid">
          <div class="card" style="grid-column: span 6;">
            <h3>Login</h3>
            <div class="input-col mt-10">
              <label>Email</label>
              <input id="loginEmail" placeholder="you@example.com" type="email"/>
            </div>
            <div class="input-col mt-10">
              <label>Password</label>
              <input id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" type="password"/>
            </div>
            <div class="mt-14" style="display:flex; gap:8px;">
              <button class="btn" id="loginBtn">Login</button>
              <button class="btn ghost" id="forgotBtn">Forgot Password</button>
            </div>
          </div>
          <div class="card" style="grid-column: span 6;">
            <h3>Signup</h3>
            <div class="input-col mt-10">
              <label>Name</label>
              <input id="signupName" placeholder="Your name"/>
            </div>
            <div class="input-col mt-10">
              <label>Email</label>
              <input id="signupEmail" placeholder="you@example.com" type="email"/>
            </div>
            <div class="input-col mt-10">
              <label>Password</label>
              <input id="signupPassword" placeholder="Create a password" type="password"/>
            </div>
            <div class="mt-14"><button class="btn" id="signupBtn">Create Account</button></div>
          </div>
        </div>
      </section>

      <section id="screen-dashboard" class="screen active">
        <div class="hero">
          <h2 style="margin:0 0 6px 0">Welcome to GlobeTrotter ‚úàÔ∏è</h2>
          <div class="hint">Dream, design, and organize multi-city trips with interactive planning, smart budgeting, and easy sharing.</div>
          <div class="mt-10" style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" data-route="createTrip">Start Planning</button>
            <button class="btn secondary" data-route="citySearch">Explore Cities</button>
            <button class="btn ghost" data-route="activitySearch">Browse Activities</button>
          </div>
        </div>

        <div class="kpi mt-14">
          <div class="card"><div class="value" id="kpiTrips">0</div><div class="label">Total Trips</div></div>
          <div class="card"><div class="value" id="kpiUpcoming">0</div><div class="label">Upcoming</div></div>
          <div class="card"><div class="value" id="kpiBudget">$0</div><div class="label">Avg. Daily Budget</div></div>
          <div class="card"><div class="value" id="kpiCities">0</div><div class="label">Cities Explored</div></div>
        </div>

        <div class="grid mt-14">
          <div class="card" style="grid-column: span 8;">
            <div class="flex items-center justify-between mb-10">
              <h3>Your Recent Trips</h3>
              <button class="btn ghost" data-route="trips">View all</button>
            </div>
            <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 12px;" id="recentTrips"></div>
          </div>
          <div class="card" style="grid-column: span 4;">
            <h3>Recommended Destinations</h3>
            <div class="list" id="recommendedDestinations"></div>
          </div>
        </div>
      </section>

      <section id="screen-createTrip" class="screen">
        <div class="card">
          <h3>Create a New Trip</h3>
          <div class="input-row mt-10">
            <div class="input-col"><label>Trip Name</label><input id="tripName" placeholder="Summer in Europe"/></div>
            <div class="input-col"><label>Cover Photo URL (optional)</label><input id="tripCover" placeholder="https://..."/></div>
          </div>
          <div class="input-row mt-10">
            <div class="input-col"><label>Start Date</label><input id="tripStart" type="date"/></div>
            <div class="input-col"><label>End Date</label><input id="tripEnd" type="date"/></div>
          </div>
          <div class="input-col mt-10"><label>Description</label><textarea id="tripDesc" rows="3" placeholder="What‚Äôs the vibe of this trip?"></textarea></div>
          <div class="mt-14"><button class="btn" id="saveTripBtn">Save Trip</button></div>
        </div>
      </section>

      <section id="screen-trips" class="screen">
        <div class="flex items-center justify-between">
          <h3>My Trips</h3>
          <button class="btn" data-route="createTrip">+ New Trip</button>
        </div>
        <div class="grid mt-10" style="grid-template-columns: repeat(3, 1fr); gap: 12px;" id="tripList"></div>
      </section>

      <section id="screen-builder" class="screen">
        <div class="grid" style="grid-template-columns: 2fr 1fr; gap: 12px;">
          <div class="card">
            <div class="flex items-center justify-between">
              <h3>Itinerary Builder</h3>
              <select id="builderTripSelect"></select>
            </div>
            <div class="mt-10">
              <div class="input-row">
                <div class="input-col"><label>City</label><input id="stopCity" placeholder="Paris" list="cityList"/></div>
                <div class="input-col"><label>Country</label><input id="stopCountry" placeholder="France"/></div>
              </div>
              <div class="input-row mt-10">
                <div class="input-col"><label>Start</label><input id="stopStart" type="date"/></div>
                <div class="input-col"><label>End</label><input id="stopEnd" type="date"/></div>
              </div>
              <div class="input-row mt-10">
                <div class="input-col"><label>Estimated Stay Cost (per night)</label><input id="stopStayCost" type="number" min="0" placeholder="120"/></div>
                <div class="input-col"><label>Transport Cost to Next</label><input id="stopTransport" type="number" min="0" placeholder="60"/></div>
              </div>
              <div class="mt-14"><button class="btn" id="addStopBtn">Add Stop</button></div>
              <datalist id="cityList"></datalist>
            </div>
            <div class="mt-14">
              <h3>Stops</h3>
              <div class="list" id="stopList"></div>
            </div>
          </div>
          <div class="card">
            <h3>Activities for Selected Stop</h3>
            <div class="hint">Select a stop to add activities.</div>
            <div class="mt-10">
              <div class="input-row">
                <div class="input-col"><label>Activity Name</label><input id="actName" placeholder="Louvre Tour"/></div>
                <div class="input-col"><label>Category</label>
                  <select id="actCategory">
                    <option>Sightseeing</option>
                    <option>Food & Drink</option>
                    <option>Adventure</option>
                    <option>Culture</option>
                    <option>Relax</option>
                  </select>
                </div>
              </div>
              <div class="input-row mt-10">
                <div class="input-col"><label>Date</label><input id="actDate" type="date"/></div>
                <div class="input-col"><label>Time</label><input id="actTime" type="time"/></div>
              </div>
              <div class="input-row mt-10">
                <div class="input-col"><label>Duration (hrs)</label><input id="actDuration" type="number" min="0" step="0.5" placeholder="2"/></div>
                <div class="input-col"><label>Cost</label><input id="actCost" type="number" min="0" placeholder="35"/></div>
              </div>
              <div class="mt-14"><button class="btn" id="addActivityBtn">Add Activity</button></div>
            </div>
            <div class="mt-14 list" id="activityList"></div>
          </div>
        </div>
      </section>

      <section id="screen-itinerary" class="screen">
        <div class="flex items-center justify-between">
          <h3>Itinerary View</h3>
          <select id="itineraryTripSelect"></select>
        </div>
        <div class="mt-10" id="itineraryView"></div>
      </section>

      <section id="screen-citySearch" class="screen">
        <div class="card">
          <h3>City Search</h3>
          <div class="input-row mt-10">
            <div class="input-col"><label>Search City</label><input id="citySearchInput" placeholder="Tokyo, Kyoto..."/></div>
            <div class="input-col"><label>Filter by Country</label><input id="cityFilterCountry" placeholder="Japan"/></div>
          </div>
          <div class="chips mt-10">
            <span class="chip" data-cost="low">$ Budget</span>
            <span class="chip" data-cost="mid">$$ Mid</span>
            <span class="chip" data-cost="high">$$$ Premium</span>
          </div>
        </div>
        <div class="grid mt-10" style="grid-template-columns: repeat(3, 1fr); gap: 12px;" id="cityResults"></div>
      </section>

      <section id="screen-activitySearch" class="screen">
        <div class="card">
          <h3>Activity Search</h3>
          <div class="input-row mt-10">
            <div class="input-col"><label>Search</label><input id="activitySearchInput" placeholder="museum, food tour, hike..."/></div>
            <div class="input-col"><label>Filter by Type</label>
              <select id="activityTypeFilter">
                <option value="">All</option>
                <option>Sightseeing</option>
                <option>Food & Drink</option>
                <option>Adventure</option>
                <option>Culture</option>
                <option>Relax</option>
              </select>
            </div>
          </div>
        </div>
        <div class="grid mt-10" style="grid-template-columns: repeat(3, 1fr); gap: 12px;" id="activityResults"></div>
      </section>

      <section id="screen-budget" class="screen">
        <div class="flex items-center justify-between">
          <h3>Budget & Cost Breakdown</h3>
          <select id="budgetTripSelect"></select>
        </div>
        <div class="grid mt-10" style="grid-template-columns: 1.2fr 1fr; gap: 12px;">
          <div class="card">
            <h3>Summary</h3>
            <div class="kpi mt-10" style="grid-template-columns: repeat(3,1fr);">
              <div class="card"><div class="value" id="sumTotal">$0</div><div class="label">Total</div></div>
              <div class="card"><div class="value" id="sumPerDay">$0</div><div class="label">Avg/Day</div></div>
              <div class="card"><div class="value" id="sumDays">0</div><div class="label">Days</div></div>
            </div>
            <div class="mt-14">
              <h3>Breakdown</h3>
              <div class="list mt-10" id="breakdownList"></div>
            </div>
          </div>
          <div class="card">
            <h3>Charts</h3>
            <canvas id="pieChart" width="400" height="300" style="width:100%; background:#0b1225; border:1px solid var(--border); border-radius:14px;"></canvas>
            <canvas id="barChart" width="400" height="300" style="width:100%; margin-top:12px; background:#0b1225; border:1px solid var(--border); border-radius:14px;"></canvas>
          </div>
        </div>
        <div class="card mt-10">
          <h3>Overbudget Alerts</h3>
          <div class="list mt-10" id="overBudgetDays"></div>
        </div>
      </section>

      <section id="screen-timeline" class="screen">
        <div class="flex items-center justify-between">
          <h3>Trip Calendar / Timeline</h3>
          <select id="timelineTripSelect"></select>
        </div>
        <div class="grid mt-10" style="grid-template-columns: 1fr 1fr; gap: 12px;">
          <div class="card">
            <h3>Timeline</h3>
            <div class="timeline mt-10" id="timeline"></div>
          </div>
          <div class="card">
            <h3>Calendar (by weeks)</h3>
            <div class="calendar-grid mt-10" id="calendar"></div>
          </div>
        </div>
      </section>

      <section id="screen-share" class="screen">
        <div class="card">
          <h3>Shared/Public Itinerary</h3>
          <div class="input-row mt-10">
            <div class="input-col">
              <label>Select Trip</label>
              <select id="shareTripSelect"></select>
            </div>
            <div class="input-col">
              <label>Public URL</label>
              <input id="publicUrl" readonly />
            </div>
          </div>
          <div class="mt-10" style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" id="generateShare">Generate Link</button>
            <button class="btn secondary" id="copyShare">Copy Link</button>
            <button class="btn ghost" id="importShared">Import from URL</button>
          </div>
          <div class="mt-14 hint">The link encodes your trip data in the URL hash‚Äîgreat for demos. For production, use backend routes + IDs.</div>
          <div class="mt-14" id="publicPreview"></div>
        </div>
      </section>

      <section id="screen-profile" class="screen">
        <div class="card">
          <h3>User Profile / Settings</h3>
          <div class="input-row mt-10">
            <div class="input-col"><label>Name</label><input id="profileName"/></div>
            <div class="input-col"><label>Email</label><input id="profileEmail" type="email"/></div>
          </div>
          <div class="input-row mt-10">
            <div class="input-col"><label>Language</label>
              <select id="profileLang">
                <option>English</option>
                <option>‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                <option>Espa√±ol</option>
                <option>Fran√ßais</option>
              </select>
            </div>
            <div class="input-col"><label>Saved Destinations (comma separated)</label><input id="profileSaved" placeholder="Paris, Tokyo"/></div>
          </div>
          <div class="mt-14" style="display:flex; gap:8px;">
            <button class="btn" id="saveProfile">Save</button>
            <button class="btn ghost" id="deleteAccount">Delete Account</button>
          </div>
        </div>
      </section>

      <section id="screen-admin" class="screen">
        <div class="card">
          <h3>Admin / Analytics (Demo)</h3>
          <div class="kpi mt-10" style="grid-template-columns: repeat(4,1fr);">
            <div class="card"><div class="value" id="admUsers">0</div><div class="label">Users</div></div>
            <div class="card"><div class="value" id="admTrips">0</div><div class="label">Trips</div></div>
            <div class="card"><div class="value" id="admTopCity">-</div><div class="label">Top City</div></div>
            <div class="card"><div class="value" id="admAvgStops">0</div><div class="label">Avg Stops/Trip</div></div>
          </div>
          <div class="mt-14">
            <canvas id="admChart" width="800" height="300" style="width:100%; background:#0b1225; border:1px solid var(--border); border-radius:14px;"></canvas>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // --- Simple SPA Router ---
    const routeMap = {
      auth: 'screen-auth',
      dashboard: 'screen-dashboard',
      createTrip: 'screen-createTrip',
      trips: 'screen-trips',
      builder: 'screen-builder',
      itinerary: 'screen-itinerary',
      citySearch: 'screen-citySearch',
      activitySearch: 'screen-activitySearch',
      budget: 'screen-budget',
      timeline: 'screen-timeline',
      share: 'screen-share',
      profile: 'screen-profile',
      admin: 'screen-admin',
    };

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    const screens = Object.values(routeMap).map(id => document.getElementById(id));

    function navigate(route) {
      const id = routeMap[route] || routeMap.dashboard;
      screens.forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      $$('#nav button').forEach(b => b.classList.toggle('active', b.dataset.route === route));
      $('#activeRouteLabel').textContent = route[0].toUpperCase() + route.slice(1);
      window.location.hash = route;
      // lazy refresh per route
      refresh(route);
    }

    $$('#nav button, .toolbar [data-route]').forEach(btn => btn.addEventListener('click', () => navigate(btn.dataset.route)));

    window.addEventListener('hashchange', () => {
      const route = location.hash.replace('#','') || 'dashboard';
      navigate(route);
    });

    // --- Data Layer (localStorage) ---
    const store = {
      get users(){ return JSON.parse(localStorage.getItem('gt_users')||'[]'); },
      set users(v){ localStorage.setItem('gt_users', JSON.stringify(v)); },
      get currentUser(){ return JSON.parse(localStorage.getItem('gt_currentUser')||'null'); },
      set currentUser(v){ localStorage.setItem('gt_currentUser', JSON.stringify(v)); updateUserCard(); },
      get trips(){ return JSON.parse(localStorage.getItem('gt_trips')||'[]'); },
      set trips(v){ localStorage.setItem('gt_trips', JSON.stringify(v)); updateKPIs(); renderTrips(); },
    };

    // Seed demo data on first load
    if (!localStorage.getItem('gt_seeded')) {
      store.users = [{ id: uid(), name: 'Demo User', email: 'demo@demo.dev', password: 'demo', lang: 'English', saved: 'Paris,Tokyo' }];
      const demoUser = store.users[0];
      store.currentUser = { id: demoUser.id, name: demoUser.name, email: demoUser.email };
      store.trips = [ sampleTrip('Euro Summer', '2025-06-10', '2025-06-24'), sampleTrip('Japan Sprint', '2025-09-01', '2025-09-10') ];
      localStorage.setItem('gt_seeded','1');
    }

    function uid(){ return Math.random().toString(36).slice(2,9); }

    function sampleTrip(name, start, end){
      const id = uid();
      return {
        id, name, cover:'', desc:'', start, end, userId: store.currentUser?.id,
        stops:[
          { id: uid(), city:'Paris', country:'France', start, end: addDays(start,3), stayCost:140, transport:80, activities:[
            { id: uid(), name:'Louvre Museum', category:'Culture', date: start, time:'10:00', duration:3, cost:25 },
            { id: uid(), name:'Seine Cruise', category:'Sightseeing', date: addDays(start,1), time:'18:00', duration:1.5, cost:18 },
          ]},
          { id: uid(), city:'Rome', country:'Italy', start: addDays(start,3), end: addDays(start,7), stayCost:120, transport:120, activities:[
            { id: uid(), name:'Colosseum Tour', category:'Culture', date: addDays(start,4), time:'11:00', duration:2, cost:30 },
          ]},
        ]
      }
    }

    function addDays(dateStr, days){
      const d = new Date(dateStr); d.setDate(d.getDate()+Number(days)); return d.toISOString().slice(0,10);
    }

    // --- Auth ---
    function updateUserCard(){
      const u = store.currentUser;
      $('#userName').textContent = u ? u.name : 'Guest';
      $('#userEmail').textContent = u ? u.email : 'Not signed in';
    }

    $('#loginBtn').addEventListener('click', () => {
      const email = $('#loginEmail').value.trim();
      const pw = $('#loginPassword').value;
      const u = store.users.find(x=>x.email===email && x.password===pw);
      if (!u) return alert('Invalid credentials. Try demo@demo.dev / demo');
      store.currentUser = { id: u.id, name: u.name, email: u.email };
      navigate('dashboard');
    });

    $('#signupBtn').addEventListener('click', () => {
      const name = $('#signupName').value.trim();
      const email = $('#signupEmail').value.trim();
      const pw = $('#signupPassword').value;
      if(!name||!email||!pw) return alert('Please fill all fields.');
      if (store.users.some(u=>u.email===email)) return alert('Email already in use.');
      const u = { id: uid(), name, email, password: pw, lang: 'English', saved:'' };
      store.users = [...store.users, u];
      store.currentUser = { id: u.id, name: u.name, email: u.email };
      alert('Account created!');
      navigate('dashboard');
    });

    $('#forgotBtn').addEventListener('click', () => alert('Demo-only: password reset not implemented.'));
    $('#logoutBtn').addEventListener('click', () => { store.currentUser = null; navigate('auth'); });

    // --- Dashboard ---
    function updateKPIs(){
      const trips = store.trips;
      $('#kpiTrips').textContent = String(trips.length);
      $('#tripCount').textContent = String(trips.length);
      const upcoming = trips.filter(t => new Date(t.start) >= new Date());
      $('#kpiUpcoming').textContent = String(upcoming.length);
      const cities = new Set(trips.flatMap(t=>t.stops.map(s=>s.city)));
      $('#kpiCities').textContent = String(cities.size);
      const avgDayBudget = Math.round( (trips.reduce((acc,t)=> acc + tripTotals(t).perDay, 0) / Math.max(trips.length,1)) );
      $('#kpiBudget').textContent = `$${avgDayBudget||0}`;
      // Recent
      const recent = [...trips].slice(-6).reverse();
      const host = $('#recentTrips'); host.innerHTML = '';
      recent.forEach(t=> host.appendChild(tripCard(t)));
      // Recommended
      const recs = sampleCities.slice(0,6);
      const recHost = $('#recommendedDestinations'); recHost.innerHTML='';
      recs.forEach(c=>{
        const item = document.createElement('div');
        item.className='list-item';
        item.innerHTML = `<div><div style="font-weight:700">${c.city}, ${c.country}</div><div class="hint">Cost Index: ${c.cost} ‚Ä¢ Popularity: ${c.popularity}</div></div><div class="actions"><button class="btn ghost" data-addcity='${JSON.stringify(c).replace(/"/g,'&quot;')}'>Add</button></div>`;
        item.querySelector('button').addEventListener('click',()=>{
          navigate('builder');
          $('#stopCity').value=c.city; $('#stopCountry').value=c.country; $('#stopStayCost').value=c.avgStay;
        });
        recHost.appendChild(item);
      })
    }

    function tripCard(t){
      const el = document.createElement('div');
      el.className = 'trip-card';
      const img = t.cover ? `<img src="${t.cover}" alt="Cover" style="height:120px;object-fit:cover;border-radius:12px;">` : '';
      el.innerHTML = `${img}<div class="trip-title">${t.name}</div><div class="trip-meta">${t.start} ‚Üí ${t.end} ‚Ä¢ ${t.stops.length} stops</div><div class="trip-actions"><button class="btn secondary" data-view>View</button><button class="btn ghost" data-edit>Edit</button><button class="btn danger" data-del>Delete</button></div>`;
      el.querySelector('[data-view]').addEventListener('click', ()=> { selectTrip(t.id); navigate('itinerary'); });
      el.querySelector('[data-edit]').addEventListener('click', ()=> { selectTrip(t.id); navigate('builder'); });
      el.querySelector('[data-del]').addEventListener('click', ()=> { if(confirm('Delete this trip?')) { store.trips = store.trips.filter(x=>x.id!==t.id); } });
      return el;
    }

    // --- Create Trip ---
    $('#saveTripBtn').addEventListener('click', () => {
      const name = $('#tripName').value.trim();
      const cover = $('#tripCover').value.trim();
      const start = $('#tripStart').value; const end = $('#tripEnd').value;
      const desc = $('#tripDesc').value.trim();
      if(!name||!start||!end) return alert('Please fill the required fields.');
      const trip = { id: uid(), name, cover, start, end, desc, userId: store.currentUser?.id, stops: [] };
      store.trips = [...store.trips, trip];
      clearCreateTrip();
      selectTrip(trip.id);
      navigate('builder');
    });

    function clearCreateTrip(){ ['tripName','tripCover','tripStart','tripEnd','tripDesc'].forEach(id=> $('#'+id).value=''); }

    // --- Trip List ---
    function renderTrips(){
      const host = $('#tripList'); host.innerHTML='';
      store.trips.forEach(t => host.appendChild(tripCard(t)));
    }

    // --- Builder ---
    function selectTrip(id){ localStorage.setItem('gt_selectedTrip', id); refreshSelects(); renderStops(); renderActivities(); refreshBudget(); renderTimeline(); renderItinerary(); }
    function currentTrip(){ const id = localStorage.getItem('gt_selectedTrip'); return store.trips.find(t=>t.id===id) || store.trips[0]; }

    function refreshSelects(){
      const options = store.trips.map(t=>`<option value="${t.id}">${t.name}</option>`).join('');
      ['builderTripSelect','itineraryTripSelect','budgetTripSelect','timelineTripSelect','shareTripSelect'].forEach(id=>{
        const sel = $('#'+id); if (!sel) return; sel.innerHTML = options; const ct = currentTrip(); if(ct) sel.value = ct.id;
        sel.onchange = () => { selectTrip(sel.value); };
      });
    }

    $('#addStopBtn').addEventListener('click', () => {
      const t = currentTrip(); if(!t) return alert('Create a trip first.');
      const city = $('#stopCity').value.trim();
      const country = $('#stopCountry').value.trim();
      const start = $('#stopStart').value; const end = $('#stopEnd').value;
      const stayCost = Number($('#stopStayCost').value||0);
      const transport = Number($('#stopTransport').value||0);
      if(!city||!start||!end) return alert('City and dates are required.');
      t.stops.push({ id: uid(), city, country, start, end, stayCost, transport, activities: [] });
      store.trips = store.trips.map(x=>x.id===t.id? t : x);
      renderStops(); refreshBudget(); renderTimeline(); renderItinerary();
      // clear
      ['stopCity','stopCountry','stopStart','stopEnd','stopStayCost','stopTransport'].forEach(id=> $('#'+id).value='');
    });

    function renderStops(){
      const t = currentTrip(); const host = $('#stopList'); host.innerHTML=''; if(!t) return;
      t.stops.sort((a,b)=>a.start.localeCompare(b.start));
      t.stops.forEach((s,idx)=>{
        const d = document.createElement('div'); d.className='stop';
        d.innerHTML = `<div class="flex items-center justify-between"><div style="font-weight:700">${s.city}, ${s.country}</div><div class="pill">${s.start} ‚Üí ${s.end}</div></div>
          <div class="hint mt-6">Stay $${s.stayCost}/night ‚Ä¢ Transport to next $${s.transport}</div>
          <div class="mt-10 flex gap-8">
            <button class="btn ghost" data-sel="${s.id}">Select</button>
            <button class="btn secondary" data-mv="up">‚¨ÜÔ∏è</button>
            <button class="btn secondary" data-mv="down">‚¨áÔ∏è</button>
            <button class="btn danger" data-del>Delete</button>
          </div>`;
        d.querySelector('[data-sel]').addEventListener('click', ()=>{ localStorage.setItem('gt_selectedStop', s.id); renderActivities(); });
        d.querySelector('[data-del]').addEventListener('click', ()=>{ if(confirm('Remove stop?')) { t.stops = t.stops.filter(x=>x.id!==s.id); store.trips = store.trips.map(x=>x.id===t.id? t : x); renderStops(); renderActivities(); refreshBudget(); renderTimeline(); renderItinerary(); }});
        d.querySelector('[data-mv="up"]').addEventListener('click', ()=>{ if(idx>0){ const tmp = t.stops[idx-1]; t.stops[idx-1]=t.stops[idx]; t.stops[idx]=tmp; store.trips = store.trips.map(x=>x.id===t.id? t : x); renderStops(); renderTimeline(); renderItinerary(); }});
        d.querySelector('[data-mv="down"]').addEventListener('click', ()=>{ if(idx<t.stops.length-1){ const tmp = t.stops[idx+1]; t.stops[idx+1]=t.stops[idx]; t.stops[idx]=tmp; store.trips = store.trips.map(x=>x.id===t.id? t : x); renderStops(); renderTimeline(); renderItinerary(); }});
        host.appendChild(d);
      })
    }

    $('#addActivityBtn').addEventListener('click', () => {
      const t = currentTrip(); if(!t) return;
      const sid = localStorage.getItem('gt_selectedStop'); const s = t.stops.find(x=>x.id===sid) || t.stops[0]; if(!s) return alert('Add a stop first.');
      const name = $('#actName').value.trim();
      const category = $('#actCategory').value;
      const date = $('#actDate').value; const time = $('#actTime').value || '10:00';
      const duration = Number($('#actDuration').value||1);
      const cost = Number($('#actCost').value||0);
      if(!name||!date) return alert('Activity name and date are required.');
      s.activities.push({ id: uid(), name, category, date, time, duration, cost });
      store.trips = store.trips.map(x=>x.id===t.id? t : x);
      renderActivities(); refreshBudget(); renderTimeline(); renderItinerary();
      ['actName','actDate','actTime','actDuration','actCost'].forEach(id=> $('#'+id).value='');
    });

    function renderActivities(){
      const t = currentTrip(); const host = $('#activityList'); host.innerHTML=''; if(!t) return;
      const sid = localStorage.getItem('gt_selectedStop'); const s = t.stops.find(x=>x.id===sid) || t.stops[0]; if(!s) { host.innerHTML='<div class="hint">No stop selected.</div>'; return; }
      s.activities.sort((a,b)=> (a.date+a.time).localeCompare(b.date+b.time));
      s.activities.forEach(a=>{
        const li = document.createElement('div'); li.className='activity';
        li.innerHTML = `<div><div style="font-weight:700">${a.name}</div><div class="hint">${a.category} ‚Ä¢ ${a.date} ${a.time} ‚Ä¢ ${a.duration}h</div></div><div class="flex gap-8"><span class="pill">$${a.cost}</span><button class="btn danger" data-del>Delete</button></div>`;
        li.querySelector('[data-del]').addEventListener('click', ()=>{ s.activities = s.activities.filter(x=>x.id!==a.id); store.trips = store.trips.map(x=>x.id===t.id? t : x); renderActivities(); refreshBudget(); renderTimeline(); renderItinerary(); });
        host.appendChild(li);
      })
    }

    // --- Itinerary View ---
    function renderItinerary(){
      const t = currentTrip(); const host = $('#itineraryView'); host.innerHTML=''; if(!t) return;
      const byDay = {};
      t.stops.forEach(s=>{
        rangeDates(s.start, s.end).forEach(d=>{
          byDay[d] ||= { date:d, items:[] };
          byDay[d].items.push({ type:'stop', label:`${s.city}, ${s.country}`, s });
        });
        s.activities.forEach(a=>{
          byDay[a.date] ||= { date:a.date, items:[] };
          byDay[a.date].items.push({ type:'activity', a, s });
        })
      });
      const days = Object.values(byDay).sort((a,b)=>a.date.localeCompare(b.date));
      if(!days.length){ host.innerHTML='<div class="hint">No items yet. Add stops and activities.</div>'; return; }
      days.forEach(day=>{
        const card = document.createElement('div'); card.className='card';
        const items = day.items.sort((i,j)=> (i.a?i.a.time:'00:00').localeCompare(j.a?j.a.time:'00:00'));
        card.innerHTML = `<div class="flex items-center justify-between"><div style="font-weight:700">${day.date}</div><div class="pill">${items.length} items</div></div>`;
        items.forEach(it=>{
          const row = document.createElement('div'); row.className='list-item mt-6';
          if(it.type==='stop'){
            row.innerHTML = `<div><div style="font-weight:700">Stay in ${it.s.city}</div><div class="hint">${it.s.country} ‚Ä¢ $${it.s.stayCost}/night</div></div><div class="pill tag-green">Stop</div>`;
          } else {
            row.innerHTML = `<div><div style="font-weight:700">${it.a.name}</div><div class="hint">${it.a.category} ‚Ä¢ ${it.a.time} ‚Ä¢ ${it.a.duration}h</div></div><div class="pill">$${it.a.cost}</div>`;
          }
          card.appendChild(row);
        })
        host.appendChild(card);
      })
    }

    // --- City Search ---
    const sampleCities = [
      { city:'Paris', country:'France', cost:'$$', popularity:'High', avgStay:140 },
      { city:'Tokyo', country:'Japan', cost:'$$$', popularity:'High', avgStay:180 },
      { city:'Bangkok', country:'Thailand', cost:'$', popularity:'High', avgStay:60 },
      { city:'Lisbon', country:'Portugal', cost:'$$', popularity:'Rising', avgStay:110 },
      { city:'Istanbul', country:'T√ºrkiye', cost:'$', popularity:'High', avgStay:70 },
      { city:'Bali', country:'Indonesia', cost:'$', popularity:'High', avgStay:80 },
      { city:'New York', country:'USA', cost:'$$$', popularity:'High', avgStay:220 },
      { city:'Kyoto', country:'Japan', cost:'$$$', popularity:'High', avgStay:160 },
      { city:'Reykjav√≠k', country:'Iceland', cost:'$$$', popularity:'Niche', avgStay:210 },
      { city:'Prague', country:'Czechia', cost:'$$', popularity:'High', avgStay:100 },
      { city:'Jaipur', country:'India', cost:'$', popularity:'Rising', avgStay:50 },
      { city:'Dubai', country:'UAE', cost:'$$$', popularity:'High', avgStay:190 },
    ];

    function renderCitySearch(){
      const term = $('#citySearchInput').value.toLowerCase();
      const filterCountry = $('#cityFilterCountry').value.toLowerCase();
      const costFilter = document.querySelector('.chips .chip.selected')?.dataset.cost || '';
      const results = sampleCities.filter(c=>
        (!term || c.city.toLowerCase().includes(term)) &&
        (!filterCountry || c.country.toLowerCase().includes(filterCountry)) &&
        (!costFilter || (costFilter==='low'&&c.cost==='$') || (costFilter==='mid'&&c.cost==='$$') || (costFilter==='high'&&c.cost==='$$$'))
      );
      const host = $('#cityResults'); host.innerHTML='';
      $('#cityList').innerHTML = sampleCities.map(c=>`<option value="${c.city}">`).join('');
      results.forEach(c=>{
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `<div class="flex items-center justify-between"><div style="font-weight:700">${c.city}, ${c.country}</div><div class="pill">${c.cost}</div></div><div class="hint mt-6">Popularity: ${c.popularity} ‚Ä¢ Avg stay: $${c.avgStay}/night</div><div class="mt-10"><button class="btn" data-add>Add to Trip</button></div>`;
        card.querySelector('[data-add]').addEventListener('click',()=>{
          navigate('builder');
          $('#stopCity').value=c.city; $('#stopCountry').value=c.country; $('#stopStayCost').value=c.avgStay;
        })
        host.appendChild(card);
      })
    }
    $('#citySearchInput').addEventListener('input', renderCitySearch);
    $('#cityFilterCountry').addEventListener('input', renderCitySearch);
    $$('.chips .chip').forEach(chip=> chip.addEventListener('click', ()=>{ $$('.chips .chip').forEach(c=>c.classList.remove('selected')); chip.classList.add('selected'); renderCitySearch(); }));

    // --- Activity Search ---
    const sampleActivities = [
      { name:'Louvre Museum', type:'Culture', city:'Paris', cost:25, duration:3 },
      { name:'Eiffel Tower Summit', type:'Sightseeing', city:'Paris', cost:30, duration:2 },
      { name:'Sushi Making Class', type:'Food & Drink', city:'Tokyo', cost:55, duration:2.5 },
      { name:'Mt. Takao Hike', type:'Adventure', city:'Tokyo', cost:0, duration:5 },
      { name:'Temple Tour', type:'Culture', city:'Kyoto', cost:20, duration:4 },
      { name:'Street Food Crawl', type:'Food & Drink', city:'Bangkok', cost:15, duration:3 },
      { name:'Hot Spring Spa', type:'Relax', city:'Reykjav√≠k', cost:60, duration:2 },
    ];

    function renderActivitySearch(){
      const term = $('#activitySearchInput').value.toLowerCase();
      const type = $('#activityTypeFilter').value;
      const host = $('#activityResults'); host.innerHTML='';
      sampleActivities.filter(a => (!term || a.name.toLowerCase().includes(term) || a.city.toLowerCase().includes(term)) && (!type || a.type===type)).forEach(a=>{
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `<div class="flex items-center justify-between"><div><div style="font-weight:700">${a.name}</div><div class="hint">${a.city} ‚Ä¢ ${a.type} ‚Ä¢ ${a.duration}h</div></div><div class="pill">$${a.cost}</div></div><div class="mt-10"><button class="btn" data-add>Add to Builder</button></div>`;
        card.querySelector('[data-add]').addEventListener('click',()=>{
          navigate('builder');
          $('#actName').value = a.name; $('#actCategory').value = a.type; $('#actDuration').value = a.duration; $('#actCost').value = a.cost;
        })
        host.appendChild(card);
      })
    }
    $('#activitySearchInput').addEventListener('input', renderActivitySearch);
    $('#activityTypeFilter').addEventListener('change', renderActivitySearch);

    // --- Budget ---
    function tripTotals(t){
      if(!t) return { total:0, perDay:0, days:0, breakdown:{} };
      const days = Math.max(1, (new Date(t.end) - new Date(t.start)) / (1000*60*60*24));
      const breakdown = { transport:0, stay:0, activities:0, meals: Math.round(days * 25) };
      t.stops.forEach((s,idx)=>{
        const stayNights = Math.max(0, (new Date(s.end) - new Date(s.start)) / (1000*60*60*24));
        breakdown.stay += Math.round(stayNights * (s.stayCost||0));
        if (idx < t.stops.length-1) breakdown.transport += Number(s.transport||0);
        s.activities.forEach(a=> breakdown.activities += Number(a.cost||0));
      });
      const total = breakdown.transport + breakdown.stay + breakdown.activities + breakdown.meals;
      const perDay = Math.round(total / days);
      return { total, perDay, days: Math.round(days), breakdown };
    }

    function refreshBudget(){
      const t = currentTrip();
      const { total, perDay, days, breakdown } = tripTotals(t);
      $('#sumTotal').textContent = `$${total}`;
      $('#sumPerDay').textContent = `$${perDay}`;
      $('#sumDays').textContent = String(days);
      const list = $('#breakdownList'); list.innerHTML='';
      Object.entries(breakdown).forEach(([k,v])=>{
        const li = document.createElement('div'); li.className='list-item';
        li.innerHTML = `<div style="text-transform:capitalize">${k}</div><div class="pill">$${v}</div>`;
        list.appendChild(li);
      });
      // Overbudget alerts (demo: threshold $200/day)
      const alerts = $('#overBudgetDays'); alerts.innerHTML='';
      if (perDay > 200) {
        const row = document.createElement('div'); row.className='list-item';
        row.innerHTML = `<div>Average daily budget exceeds $200</div><div class="pill tag-red">Alert</div>`;
        alerts.appendChild(row);
      } else {
        alerts.innerHTML = '<div class="hint">All good! No alerts.</div>';
      }
      drawPieChart(breakdown); drawBarChart(t);
    }

    function drawPieChart(breakdown){
      const ctx = document.getElementById('pieChart').getContext('2d');
      ctx.clearRect(0,0,400,300);
      const items = Object.entries(breakdown);
      const total = items.reduce((a,[,v])=>a+v,0) || 1;
      let start = -Math.PI/2; const centerX=200, centerY=150, r=100;
      const colors = ['#60a5fa','#22d3ee','#a78bfa','#34d399','#fbbf24','#f87171'];
      items.forEach(([k,v],i)=>{
        const angle = (v/total)*Math.PI*2; ctx.beginPath(); ctx.moveTo(centerX,centerY); ctx.arc(centerX,centerY,r,start,start+angle); ctx.closePath(); ctx.fillStyle = colors[i%colors.length]; ctx.fill(); start += angle;
      });
      // legend
      items.forEach(([k,v],i)=>{ ctx.fillStyle = colors[i%colors.length]; ctx.fillRect(20,20+i*18,12,12); ctx.fillStyle='#e5e7eb'; ctx.font='12px Inter'; ctx.fillText(`${k}: $${v}`, 40, 30+i*18); })
    }

    function drawBarChart(t){
      const ctx = document.getElementById('barChart').getContext('2d');
      ctx.clearRect(0,0,400,300);
      if(!t){ return }
      const days = {};
      t.stops.forEach(s=>{
        rangeDates(s.start, s.end).forEach(d=>{ days[d] ||= 0; days[d] += (s.stayCost||0); });
        s.activities.forEach(a=>{ days[a.date] ||= 0; days[a.date] += (a.cost||0); });
      })
      const entries = Object.entries(days).sort((a,b)=>a[0].localeCompare(b[0]));
      const w = 360 / Math.max(entries.length,1);
      entries.forEach(([date,val],i)=>{
        const x = 20 + i*w; const y = 280; const h = Math.min(240, val);
        ctx.fillStyle = '#22d3ee'; ctx.fillRect(x, y-h, w-4, h);
        ctx.fillStyle = '#9ca3af'; ctx.font = '10px Inter'; ctx.fillText(date.slice(5), x, 295);
      });
    }

    // --- Timeline & Calendar ---
    function renderTimeline(){
      const t = currentTrip(); const host = $('#timeline'); host.innerHTML=''; if(!t) return;
      const items = [];
      t.stops.forEach((s,idx)=>{
        items.push({ date:s.start, label:`Arrive ${s.city}`, type:'milestone' });
        s.activities.forEach(a=> items.push({ date:a.date, label:`${a.time} ${a.name} (${s.city})`, type:'activity' }));
        items.push({ date:s.end, label:`Depart ${s.city}`, type:'milestone' });
      });
      items.sort((a,b)=>a.date.localeCompare(b.date));
      items.forEach(it=>{
        const row = document.createElement('div'); row.className='timeline-item';
        row.innerHTML = `<div class="timeline-dot"></div><div class="timeline-card"><div style="font-weight:700">${it.date}</div><div class="hint">${it.label}</div></div>`;
        host.appendChild(row);
      })
      renderCalendar();
    }

    function renderCalendar(){
      const t = currentTrip(); const host = $('#calendar'); host.innerHTML=''; if(!t) return;
      const dates = rangeDates(t.start, t.end);
      dates.forEach(d=>{ const cell = document.createElement('div'); cell.className='calendar-day'; cell.innerHTML = `<div style="font-weight:700">${d.slice(5)}</div>`; host.appendChild(cell); });
    }

    function rangeDates(start, end){
      const out = []; const s = new Date(start); const e = new Date(end);
      for(let d = new Date(s); d <= e; d.setDate(d.getDate()+1)) out.push(d.toISOString().slice(0,10));
      return out;
    }

    // --- Share/Public ---
    $('#generateShare').addEventListener('click', ()=>{
      const t = currentTrip(); if(!t) return; const data = btoa(unescape(encodeURIComponent(JSON.stringify(t))));
      const url = `${location.origin}${location.pathname}#public:${data}`; $('#publicUrl').value = url; renderPublicPreview(t);
    });
    $('#copyShare').addEventListener('click', ()=>{ const inp = $('#publicUrl'); inp.select(); document.execCommand('copy'); alert('Link copied!'); });
    $('#importShared').addEventListener('click', ()=>{
      const h = prompt('Paste a public URL'); if(!h) return; const idx = h.indexOf('#public:'); if(idx<0) return alert('Invalid link'); const data = h.slice(idx+8+1); try{ const t = JSON.parse(decodeURIComponent(escape(atob(data))));
        if(confirm(`Import trip "${t.name}"?`)){ t.id = uid(); store.trips = [...store.trips, t]; selectTrip(t.id); alert('Imported!'); navigate('itinerary'); }
      } catch(err){ alert('Failed to import'); }
    });
    function renderPublicPreview(t){
      const host = $('#publicPreview'); host.innerHTML='';
      host.appendChild(tripCard(t));
      const pre = document.createElement('pre'); pre.textContent = JSON.stringify({ name:t.name, dates:`${t.start} ‚Üí ${t.end}`, stops: t.stops.map(s=>({city:s.city, start:s.start, end:s.end, activities:s.activities.length})) }, null, 2);
      pre.style.background='#0b1225'; pre.style.padding='12px'; pre.style.border='1px solid var(--border)'; pre.style.borderRadius='12px';
      host.appendChild(pre);
    }

    // --- Profile ---
    function loadProfile(){ const u = store.currentUser; if(!u) return; const full = store.users.find(x=>x.id===u.id); if(!full) return;
      $('#profileName').value = full.name||''; $('#profileEmail').value = full.email||''; $('#profileLang').value = full.lang||'English'; $('#profileSaved').value = full.saved||'';
    }
    $('#saveProfile').addEventListener('click', ()=>{
      const u = store.currentUser; if(!u) return alert('Login first.');
      store.users = store.users.map(x=> x.id===u.id ? { ...x, name: $('#profileName').value, email: $('#profileEmail').value, lang: $('#profileLang').value, saved: $('#profileSaved').value } : x);
      store.currentUser = { ...u, name: $('#profileName').value, email: $('#profileEmail').value };
      alert('Profile saved');
    });
    $('#deleteAccount').addEventListener('click', ()=>{
      if(!confirm('Delete your account (demo-only)? This removes your user but keeps trips.')) return;
      const u = store.currentUser; if(!u) return; store.users = store.users.filter(x=>x.id!==u.id); store.currentUser = null; navigate('auth');
    });

    // --- Admin ---
    function renderAdmin(){
      const users = store.users.length; const trips = store.trips.length;
      $('#admUsers').textContent = String(users); $('#admTrips').textContent = String(trips);
      const cityCount = {};
      store.trips.forEach(t=> t.stops.forEach(s=> cityCount[s.city] = (cityCount[s.city]||0)+1));
      const topCity = Object.entries(cityCount).sort((a,b)=>b[1]-a[1])[0]?.[0] || '-';
      $('#admTopCity').textContent = topCity;
      const avgStops = Math.round((store.trips.reduce((a,t)=>a + t.stops.length,0)/Math.max(trips,1))*10)/10;
      $('#admAvgStops').textContent = String(avgStops);
      drawAdminChart();
    }

    function drawAdminChart(){
      const ctx = document.getElementById('admChart').getContext('2d'); ctx.clearRect(0,0,800,300);
      // Trips over time (by start month)
      const map = {};
      store.trips.forEach(t=>{ const m = t.start.slice(0,7); map[m] = (map[m]||0)+1; });
      const months = Object.keys(map).sort(); const w = 760/Math.max(months.length,1);
      months.forEach((m,i)=>{ const v = map[m]; const x=20+i*w; const y=280; const h=v*30; ctx.fillStyle='#8b5cf6'; ctx.fillRect(x, y-h, w-6, h); ctx.fillStyle='#9ca3af'; ctx.font='10px Inter'; ctx.fillText(m, x, 295); })
    }

    // --- Global Search ---
    $('#globalSearch').addEventListener('input', () => {
      const q = $('#globalSearch').value.toLowerCase();
      const host = $('#recentTrips'); if(!host) return;
      const results = store.trips.filter(t => t.name.toLowerCase().includes(q) || t.stops.some(s=>s.city.toLowerCase().includes(q)) || t.stops.some(s=> s.activities.some(a=>a.name.toLowerCase().includes(q))));
      host.innerHTML=''; results.forEach(t=> host.appendChild(tripCard(t)));
    });

    // --- Route refresh hooks ---
    function refresh(route){
      if(route==='dashboard'){ updateKPIs(); }
      if(route==='trips'){ renderTrips(); }
      if(route==='builder'){ refreshSelects(); renderStops(); renderActivities(); }
      if(route==='itinerary'){ refreshSelects(); renderItinerary(); }
      if(route==='citySearch'){ renderCitySearch(); }
      if(route==='activitySearch'){ renderActivitySearch(); }
      if(route==='budget'){ refreshSelects(); refreshBudget(); }
      if(route==='timeline'){ refreshSelects(); renderTimeline(); }
      if(route==='share'){ refreshSelects(); const t = currentTrip(); if(t) renderPublicPreview(t); }
      if(route==='profile'){ loadProfile(); }
      if(route==='admin'){ renderAdmin(); }
    }

    // Initial load
    updateUserCard();
    updateKPIs();
    renderTrips();
    refreshSelects();
    renderCitySearch();
    renderActivitySearch();
    // Navigate to hash route or default
    navigate(location.hash.replace('#','')||'dashboard');
  </script>
</body>
</html>
